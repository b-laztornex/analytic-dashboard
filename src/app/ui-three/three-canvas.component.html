<div class="toolbar">
  <label class="toggle"><span>Overlay</span><input type="checkbox" [checked]="store.showOverlay()" (change)="store.toggleOverlay($any($event.target).checked)"></label>
  <label class="toggle"><span>Wireframe</span><input type="checkbox" [checked]="store.wireframe()" (change)="store.toggleWireframe($any($event.target).checked)"></label>
  <label class="toggle"><span>2D</span><input type="checkbox" [checked]="store.twoD()" (change)="store.toggleTwoD($any($event.target).checked)"></label>
  <label class="toggle" *ngFor="let _ of [0,1,2,3]; let i = index">
    <span>C{{i}}</span>
    <input type="checkbox" [checked]="$any(clustersVisible())[i]" (change)="toggleClusterIndex(i)">
  </label>


  <button (click)="resetView()">Reset View</button>
  <button (click)="xray.set(!xray())">{{ xray() ? 'Normal' : 'X-ray' }}</button>
  <label class="toggle">
    <span>Full color</span>
    <input type="checkbox" [checked]="!!modelColor()" (change)="toggleFullColor($any($event.target).checked)" />
  </label>
  <label>
    Color
    <input type="color" [value]="modelColor() ?? '#ffffff'" (input)="onColorInput($any($event.target).value)" />
    <button type="button" (click)="clearColor()">Clear</button>
  </label>
  <a routerLink="/plots" class="btn">Charts</a>
</div>
<canvas #canvas class="viewport" aria-label="3D Heart"></canvas>

<!-- 2D medical notes overlay -->
@if (store.twoD()) {
  <div class="notes-layer">
    @if (!selectedId()) {
      <div class="notes-empty">No patient selected</div>
    }
    @for (n of notes(); track n.id) {
      @if (n.visible) {
        <svg class="note-lines" aria-hidden="true">
          <line [attr.x1]="n.anchorSX" [attr.y1]="n.anchorSY" [attr.x2]="n.screenX" [attr.y2]="n.screenY" />
        </svg>
        @if (!n.collapsed) {
          <div class="note note-card" [style.left.px]="n.screenX" [style.top.px]="n.screenY">
            <div class="note-header">
              <button class="collapse-btn" (click)="toggleNote(n.id)" aria-label="Collapse note">
                <span class="icon minus"></span>
              </button>
            </div>
            <div class="note-body">
              <div class="note-title">{{ n.title }}</div>
              <div class="note-text">{{ n.body }}</div>
            </div>
          </div>
        } @else {
          <div class="note-collapsed" [style.left.px]="n.screenX" [style.top.px]="n.screenY">
            <button class="note-plus" (click)="toggleNote(n.id)" aria-label="Expand note">
              <span class="icon plus"></span>
            </button>
          </div>
        }
      }
    }
    <!-- gradient mask for subtle readability over canvas -->
    <div class="notes-mask"></div>
  </div>
}
